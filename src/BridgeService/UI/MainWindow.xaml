<Window x:Class="HardwareBridge.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Hardware Bridge Service Settings" Height="600" Width="800"
        WindowStartupLocation="CenterScreen"
        Icon="icon.ico">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#FF0078D4" Padding="20">
            <StackPanel>
                <TextBlock Text="Hardware Bridge Service" FontSize="24" FontWeight="Bold" Foreground="White"/>
                <TextBlock Text="Configure WebSocket server and device settings" FontSize="12" Foreground="White" Opacity="0.8" Margin="0,5,0,0"/>
            </StackPanel>
        </Border>

        <!-- Tab Control -->
        <TabControl Grid.Row="1" Margin="20" Padding="10">
            
            <!-- General Tab -->
            <TabItem Header="General">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <GroupBox Header="Service Information" Margin="0,0,0,20">
                            <StackPanel Margin="10">
                                <TextBlock Text="Service Status: Running" FontWeight="Bold" Margin="0,0,0,10"/>
                                <TextBlock Text="Version: 1.0.0" Margin="0,0,0,5"/>
                                <TextBlock Text="Build: Release" Margin="0,0,0,5"/>
                                <TextBlock Text="Uptime: Calculating..." Name="UptimeText" Margin="0,0,0,5"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Device Discovery" Margin="0,0,0,20">
                            <StackPanel Margin="10">
                                <CheckBox Name="EnablePrinterDiscovery" Content="Enable Printer Discovery" IsChecked="True" Margin="0,0,0,10"/>
                                <CheckBox Name="EnableSerialPortDiscovery" Content="Enable Serial Port Discovery" IsChecked="True" Margin="0,0,0,10"/>
                                <CheckBox Name="EnableUsbHidDiscovery" Content="Enable USB HID Discovery" IsChecked="True" Margin="0,0,0,10"/>
                                <Label Content="Discovery Interval (ms):" Margin="0,0,0,5"/>
                                <TextBox Name="DiscoveryIntervalTextBox" Text="5000" Width="100" HorizontalAlignment="Left"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Connection Pool" Margin="0,0,0,20">
                            <StackPanel Margin="10">
                                <Label Content="Maximum Connections:" Margin="0,0,0,5"/>
                                <TextBox Name="MaxConnectionsTextBox" Text="100" Width="100" HorizontalAlignment="Left"/>
                                <Label Content="Connection Timeout (seconds):" Margin="0,10,0,5"/>
                                <TextBox Name="ConnectionTimeoutTextBox" Text="300" Width="100" HorizontalAlignment="Left"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- WebSocket Tab -->
            <TabItem Header="WebSocket Server">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <GroupBox Header="Server Configuration" Margin="0,0,0,20">
                            <StackPanel Margin="10">
                                <CheckBox Name="UseTlsCheckBox" Content="Use TLS/SSL" IsChecked="True" Margin="0,0,0,10"/>
                                <Label Content="Port:" Margin="0,0,0,5"/>
                                <TextBox Name="PortTextBox" Text="8443" Width="100" HorizontalAlignment="Left"/>
                                <Label Content="Allowed Origins (comma-separated):" Margin="0,10,0,5"/>
                                <TextBox Name="OriginsTextBox" Text="*" Height="60" TextWrapping="Wrap" AcceptsReturn="True"/>
                                <CheckBox Name="EnableMutualTlsCheckBox" Content="Enable Mutual TLS" IsChecked="False" Margin="0,10,0,10"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Certificate Management" Margin="0,0,0,20">
                            <StackPanel Margin="10">
                                <CheckBox Name="UseLetsEncryptCheckBox" Content="Use Let's Encrypt" IsChecked="True" Margin="0,0,0,10"/>
                                <Label Content="Domain:" Margin="0,0,0,5"/>
                                <TextBox Name="DomainTextBox" Text="localhost" Width="200" HorizontalAlignment="Left"/>
                                <Label Content="Email:" Margin="0,10,0,5"/>
                                <TextBox Name="EmailTextBox" Text="admin@localhost" Width="200" HorizontalAlignment="Left"/>
                                <Label Content="ACME Server:" Margin="0,10,0,5"/>
                                <TextBox Name="AcmeServerTextBox" Text="https://acme-v02.api.letsencrypt.org/directory" Width="400" HorizontalAlignment="Left"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Security" Margin="0,0,0,20">
                            <StackPanel Margin="10">
                                <CheckBox Name="EnableOriginValidationCheckBox" Content="Enable Origin Validation" IsChecked="True" Margin="0,0,0,10"/>
                                <CheckBox Name="EnableCapabilityTokensCheckBox" Content="Enable Capability Tokens" IsChecked="True" Margin="0,0,0,10"/>
                                <Label Content="Admin Origins (comma-separated):" Margin="0,10,0,5"/>
                                <TextBox Name="AdminOriginsTextBox" Text="localhost" Height="40" TextWrapping="Wrap" AcceptsReturn="True"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Devices Tab -->
            <TabItem Header="Devices">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                        <Button Name="RefreshDevicesButton" Content="Refresh" Width="80" Height="30" Margin="0,0,10,0" Click="RefreshDevices_Click"/>
                        <Button Name="ConnectDeviceButton" Content="Connect" Width="80" Height="30" Margin="0,0,10,0" Click="ConnectDevice_Click"/>
                        <Button Name="DisconnectDeviceButton" Content="Disconnect" Width="80" Height="30" Margin="0,0,10,0" Click="DisconnectDevice_Click"/>
                        <TextBlock Name="DeviceStatusText" VerticalAlignment="Center" Margin="20,0,0,0"/>
                    </StackPanel>

                    <DataGrid Grid.Row="1" Name="DevicesDataGrid" AutoGenerateColumns="False" IsReadOnly="True" CanUserSortColumns="True">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="200"/>
                            <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="150"/>
                            <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="80"/>
                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="80"/>
                            <DataGridTextColumn Header="Manufacturer" Binding="{Binding Manufacturer}" Width="120"/>
                            <DataGridTextColumn Header="Model" Binding="{Binding Model}" Width="120"/>
                            <DataGridTextColumn Header="Connected" Binding="{Binding IsConnected}" Width="80"/>
                            <DataGridTextColumn Header="Last Seen" Binding="{Binding LastSeen}" Width="120"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <StatusBar Grid.Row="2">
                        <StatusBarItem>
                            <TextBlock Name="DeviceCountText" Text="0 devices found"/>
                        </StatusBarItem>
                    </StatusBar>
                </Grid>
            </TabItem>

            <!-- Queue Tab -->
            <TabItem Header="Queue">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                        <Button Name="RefreshQueueButton" Content="Refresh" Width="80" Height="30" Margin="0,0,10,0" Click="RefreshQueue_Click"/>
                        <Button Name="ProcessNextButton" Content="Process Next" Width="100" Height="30" Margin="0,0,10,0" Click="ProcessNext_Click"/>
                        <Button Name="CancelJobButton" Content="Cancel Job" Width="80" Height="30" Margin="0,0,10,0" Click="CancelJob_Click"/>
                        <TextBlock Name="QueueStatusText" VerticalAlignment="Center" Margin="20,0,0,0"/>
                    </StackPanel>

                    <DataGrid Grid.Row="1" Name="QueueDataGrid" AutoGenerateColumns="False" IsReadOnly="True" CanUserSortColumns="True">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Job ID" Binding="{Binding Id}" Width="200"/>
                            <DataGridTextColumn Header="Device ID" Binding="{Binding DeviceId}" Width="150"/>
                            <DataGridTextColumn Header="Operation" Binding="{Binding Operation}" Width="100"/>
                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="80"/>
                            <DataGridTextColumn Header="Created" Binding="{Binding CreatedAt}" Width="120"/>
                            <DataGridTextColumn Header="Started" Binding="{Binding StartedAt}" Width="120"/>
                            <DataGridTextColumn Header="Completed" Binding="{Binding CompletedAt}" Width="120"/>
                            <DataGridTextColumn Header="Retries" Binding="{Binding RetryCount}" Width="60"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <StatusBar Grid.Row="2">
                        <StatusBarItem>
                            <TextBlock Name="QueueStatsText" Text="Queue statistics"/>
                        </StatusBarItem>
                    </StatusBar>
                </Grid>
            </TabItem>

            <!-- Logging Tab -->
            <TabItem Header="Logging">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <GroupBox Header="Log Configuration" Margin="0,0,0,20">
                            <StackPanel Margin="10">
                                <CheckBox Name="EnableConsoleLoggingCheckBox" Content="Enable Console Logging" IsChecked="True" Margin="0,0,0,10"/>
                                <CheckBox Name="EnableFileLoggingCheckBox" Content="Enable File Logging" IsChecked="True" Margin="0,0,0,10"/>
                                <CheckBox Name="EnableEventLogCheckBox" Content="Enable Event Log" IsChecked="True" Margin="0,0,0,10"/>
                                <CheckBox Name="EnableETWCheckBox" Content="Enable ETW Logging" IsChecked="True" Margin="0,0,0,10"/>
                                <Label Content="Log Level:" Margin="0,10,0,5"/>
                                <ComboBox Name="LogLevelComboBox" Width="120" HorizontalAlignment="Left">
                                    <ComboBoxItem Content="Verbose"/>
                                    <ComboBoxItem Content="Debug"/>
                                    <ComboBoxItem Content="Information"/>
                                    <ComboBoxItem Content="Warning"/>
                                    <ComboBoxItem Content="Error"/>
                                    <ComboBoxItem Content="Fatal"/>
                                </ComboBox>
                                <Label Content="Max File Size (MB):" Margin="0,10,0,5"/>
                                <TextBox Name="MaxFileSizeTextBox" Text="10" Width="100" HorizontalAlignment="Left"/>
                                <Label Content="Max Retained Files:" Margin="0,10,0,5"/>
                                <TextBox Name="MaxRetainedFilesTextBox" Text="30" Width="100" HorizontalAlignment="Left"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Log Viewer" Margin="0,0,0,20">
                            <StackPanel Margin="10">
                                <Button Name="OpenLogDirectoryButton" Content="Open Log Directory" Width="150" Height="30" Margin="0,0,0,10" Click="OpenLogDirectory_Click"/>
                                <Button Name="ViewLatestLogButton" Content="View Latest Log" Width="150" Height="30" Margin="0,0,0,10" Click="ViewLatestLog_Click"/>
                                <TextBox Name="LogPreviewTextBox" Height="200" IsReadOnly="True" TextWrapping="Wrap" ScrollViewer.HorizontalScrollBarVisibility="Auto" ScrollViewer.VerticalScrollBarVisibility="Auto"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <!-- Buttons -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="20">
            <Button Name="SaveButton" Content="Save" Width="80" Height="30" Margin="0,0,10,0" Click="SaveButton_Click"/>
            <Button Name="CancelButton" Content="Cancel" Width="80" Height="30" Margin="0,0,10,0" Click="CancelButton_Click"/>
            <Button Name="ApplyButton" Content="Apply" Width="80" Height="30" Click="ApplyButton_Click"/>
        </StackPanel>
    </Grid>
</Window>